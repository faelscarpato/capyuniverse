<!DOCTYPE html>
<html lang="pt-br" data-theme="capyuniverse">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CapyFocal — Ponto Focal de Marketing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="icon" href="https://raw.githubusercontent.com/faelscarpato/capyuniverse/main/2.png" type="image/png" />
  <link rel="stylesheet" href="cu-style.css" />
  <script src="cu-navigation.js" defer></script>
</head>

<body class="min-h-screen flex flex-col">
  <header class="cu-header">
    <div class="cu-brand">
      <button
        id="hamburger-button"
        class="md:hidden cu-btn flex-shrink-0 p-2"
        aria-label="Abrir menu"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <a href="index.html" class="flex items-center gap-2 group">
        <div class="cu-logo flex-shrink-0"><img src="icons/icon-512.png"></div>
        <span class="cu-appname text-lg sm:text-xl">CapyUniverse</span>
      </a>
      <span class="ml-3 text-xs text-zinc-400 hidden sm:inline">/ CapyFocal</span>
    </div>
    <nav class="hidden md:flex items-center gap-2 flex-shrink-0">
        <a href="#" class="cu-btn" data-open="contato">Contato</a>
        <a href="#" class="cu-btn" data-open="como">Como Funciona</a>
        <a href="#" class="cu-btn" data-open="quem">Quem Somos</a>
        <a href="#" class="cu-btn" data-open="faq">FAQ</a>
        <button id="openManageApiKeyModalButtonHeader" class="cu-btn primary">Chaves API</button>
    </nav>

    <!-- OVERLAY MENU MOBILE -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden opacity-0 pointer-events-none transition-opacity duration-300"></div>
    
    <!-- MENU MOBILE -->
    <div id="mobile-menu" class="mobile-menu fixed top-0 right-0 h-full w-64 bg-gray-900/95 backdrop-blur-md shadow-2xl p-6 pt-20 md:hidden translate-x-full z-50 transition-transform duration-300 ease-out">
      <nav class="flex flex-col space-y-4">
        <a href="#" class="cu-btn" data-open="contato" onclick="closeMobileMenu()">Contato</a>
        <a href="#" class="cu-btn" data-open="como" onclick="closeMobileMenu()">Como Funciona</a>
        <a href="#" class="cu-btn" data-open="quem" onclick="closeMobileMenu()">Quem Somos</a>
        <a href="#" class="cu-btn" data-open="faq" onclick="closeMobileMenu()">FAQ</a>
        <button id="openManageApiKeyModalButtonMobile" class="cu-btn primary w-full">🔑 Chaves API</button>
      </nav>
    </div>
  </header>

  <div id="notificationArea"></div>

  <div class="flex flex-1 pt-16">
    <aside
      id="sidebar"
      class="cu-panel w-64 space-y-1 p-3 fixed inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 lg:static lg:inset-0 transition-transform duration-300 ease-in-out z-30 shadow-lg overflow-y-auto scrollbar-thin pt-4"
      data-current-page-id="CapyFocal"
    >
      <p class="text-xs text-center text-cu-text-dim p-2">Carregando menu...</p>
    </aside>
    <div
      id="sidebarOverlay"
      class="fixed inset-0 bg-black/60 z-20 hidden lg:hidden"
    ></div>

    <main
      class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto w-full lg:ml-64"
    >
      <section class="cu-panel p-5 sm:p-6 lg:p-8 flex flex-col">
        <div class="text-center mb-6 sm:mb-8">
          <h1
            class="text-2xl sm:text-3xl font-bold"
            style="color: var(--cu-amber);"
          >
            CapyFocal 📣
          </h1>
          <p class="text-cu-text-dim mt-1">
            Crie campanhas e visuais marcantes com inteligência artificial.
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-[420px,1fr] gap-6 flex-1">
          <aside class="cu-panel bg-transparent p-4 sm:p-5 flex flex-col space-y-4">
            <div>
              <label class="block text-sm text-cu-text-dim mb-1" for="focalObjective">Objetivo da campanha</label>
              <textarea id="focalObjective" rows="4" class="cu-textarea" placeholder="Descreva a mensagem ou objetivo da campanha"></textarea>
            </div>
            <div class="flex flex-wrap gap-2">
              <button id="btnFocalCopy" class="cu-btn text-sm">Gerar Copy</button>
              <button id="btnFocalImage" class="cu-btn text-sm">Gerar Imagem</button>
              <button id="btnFocalPlan" class="cu-btn text-sm">Plano de Automação</button>
              <button id="btnFocalFull" class="cu-btn text-sm">Completo</button>
            </div>
          </aside>
          <section class="cu-panel bg-transparent p-4 sm:p-5 flex flex-col flex-1">
            <div class="flex flex-col gap-3 mb-4 flex-1">
              <label class="block text-sm text-cu-text-dim mb-1" for="focalResult">Resultado textual</label>
              <textarea id="focalResult" rows="8" class="cu-textarea flex-1" readonly placeholder="Aguardando geração..."></textarea>
              <div class="flex items-center gap-3">
                <button id="btnFocalOuvir" class="cu-btn" disabled><i class="fas fa-volume-high"></i> Ouvir</button>
                <button id="btnFocalCopyResult" class="cu-btn" disabled><i class="fas fa-copy"></i> Copiar</button>
                <button id="btnFocalExport" class="cu-btn" disabled><i class="fas fa-download"></i> Exportar</button>
              </div>
            </div>
            <div class="flex flex-col gap-3">
              <label class="block text-sm text-cu-text-dim">Visual gerado</label>
              <div id="focalImageContainer" class="w-full aspect-square bg-black/20 rounded-lg flex items-center justify-center overflow-hidden">
                <span class="text-cu-text-dim">Nenhuma imagem gerada</span>
              </div>
              <button id="btnFocalDownloadImage" class="cu-btn" disabled><i class="fas fa-download"></i> Baixar Imagem</button>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <script>
    const currentPageId = 'CapyFocal';
    let apiKey = localStorage.getItem('capyUniverseApiKey_gemini') || '';
    let imageUrl = '';

    const dom = {
      focalObjective: document.getElementById('focalObjective'),
      focalResult: document.getElementById('focalResult'),
      focalImageContainer: document.getElementById('focalImageContainer'),
      btnFocalCopy: document.getElementById('btnFocalCopy'),
      btnFocalImage: document.getElementById('btnFocalImage'),
      btnFocalPlan: document.getElementById('btnFocalPlan'),
      btnFocalFull: document.getElementById('btnFocalFull'),
      btnFocalOuvir: document.getElementById('btnFocalOuvir'),
      btnFocalCopyResult: document.getElementById('btnFocalCopyResult'),
      btnFocalExport: document.getElementById('btnFocalExport'),
      btnFocalDownloadImage: document.getElementById('btnFocalDownloadImage'),
    };

    function updateFocalButtons() {
      const hasObj = dom.focalObjective.value.trim().length > 0;
      [dom.btnFocalCopy, dom.btnFocalImage, dom.btnFocalPlan, dom.btnFocalFull].forEach(btn => btn.disabled = !hasObj);
      const hasResult = dom.focalResult.value.trim().length > 0;
      [dom.btnFocalOuvir, dom.btnFocalCopyResult, dom.btnFocalExport].forEach(btn => btn.disabled = !hasResult);
      dom.btnFocalDownloadImage.disabled = !imageUrl;
    }

    async function generateFocalText(type) {
      if (!apiKey) return alert('Configure a chave da API primeiro.');
      const objective = dom.focalObjective.value.trim();
      if (!objective) return alert('Descreva o objetivo da campanha.');

      // Disable buttons during processing
      [dom.btnFocalCopy, dom.btnFocalPlan, dom.btnFocalFull].forEach(btn => btn.disabled = true);
      dom.focalResult.value = 'Gerando...';

      let prompt;
      if (type === 'copy') prompt = `Crie um texto persuasivo para uma campanha de marketing com o objetivo: ${objective}.`;
      else if (type === 'plan') prompt = `Elabore um plano de automação de marketing para a campanha: ${objective}.`;
      else if (type === 'full') prompt = `Crie um pacote completo de marketing para o objetivo: ${objective}.`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        if (!response.ok) throw new Error(`Erro na API: ${response.status}`);
        const data = await response.json();
        dom.focalResult.value = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || 'Nenhum resultado.';
      } catch (err) { dom.focalResult.value = `Falha: ${err.message}`; }
      finally { updateFocalButtons(); }
    }

    async function generateFocalImage() {
      const objective = dom.focalObjective.value.trim();
      if (!objective) return alert('Descreva o objetivo da campanha para gerar uma imagem.');
      // Pollinations API call
      const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(objective)}?model=flux&width=768&height=768&safe=true`;
      dom.focalImageContainer.innerHTML = '<span class="text-cu-text-dim">Gerando imagem...</span>';
      try {
        const response = await fetch(imageUrl, { cache: 'no-store', mode: 'cors' });
        if (!response.ok) throw new Error(`Erro ao carregar imagem: ${response.status}`);
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        dom.focalImageContainer.innerHTML = `<img src="${url}" class="w-full h-full object-cover" alt="Imagem gerada por IA">`;
        dom.btnFocalDownloadImage.disabled = false;
      } catch (err) {
        dom.focalImageContainer.innerHTML = `<span class="text-red-400">Erro ao gerar imagem: ${err.message}</span>`;
        dom.btnFocalDownloadImage.disabled = true;
      }
      updateFocalButtons();
    }

    function speakFocal() { /* ... */ }
    function copyFocal() { /* ... */ }
    function exportFocal() { /* ... */ }
    function downloadFocalImage() { /* ... */ }

    document.addEventListener('DOMContentLoaded', () => {
      // Initialize CU_NAVIGATION if it exists and hasn't been initialized yet
      if (window.CU_NAVIGATION && !window.CU_NAVIGATION.isInitialized) {
        window.CU_NAVIGATION.init();
        window.CU_NAVIGATION.isInitialized = true; // Prevent re-initialization
      }
      // Render sidebar for this page
      if (window.CU_NAVIGATION && window.CU_NAVIGATION.renderSidebar) {
        window.CU_NAVIGATION.renderSidebar('CapyFocal');
      }

      dom.focalObjective.addEventListener('input', updateFocalButtons);
      dom.btnFocalCopy.addEventListener('click', () => generateFocalText('copy'));
      dom.btnFocalPlan.addEventListener('click', () => generateFocalText('plan'));
      dom.btnFocalFull.addEventListener('click', () => generateFocalText('full'));
      dom.btnFocalImage.addEventListener('click', generateFocalImage);
      dom.btnFocalOuvir.addEventListener('click', speakFocal);
      dom.btnFocalCopyResult.addEventListener('click', copyFocal);
      dom.btnFocalExport.addEventListener('click', exportFocal);
      dom.btnFocalDownloadImage.addEventListener('click', downloadFocalImage);
      updateFocalButtons();
    });
  </script>
</body>
</html>

