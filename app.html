<!DOCTYPE html>
<html lang="pt-br" class="dark scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>CapyUniverse | Agent OS</title>
  
  <meta name="description" content="O Sistema Operacional para seus Agentes de IA.">
  <meta name="theme-color" content="#030305">
  <link rel="icon" type="image/png" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet"/>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    /* --- NÚCLEO VISUAL --- */
    :root {
      --bg-void: #030305;
      --glass-heavy: rgba(20, 20, 25, 0.95);
      --glass-light: rgba(255, 255, 255, 0.03);
      --border-subtle: rgba(255, 255, 255, 0.08);
      --neon-primary: #a855f7;
      --neon-accent: #10b981;
    }

    body {
      background-color: var(--bg-void);
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
      overscroll-behavior: none; /* Previne "puxar" a página */
    }

    /* Background */
    .quantum-bg {
      position: fixed; inset: 0; z-index: -1;
      background: 
        radial-gradient(800px circle at 20% 20%, rgba(168, 85, 247, 0.06), transparent 40%),
        radial-gradient(600px circle at 80% 80%, rgba(59, 130, 246, 0.06), transparent 40%),
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    }
    .font-space { font-family: 'Space Grotesk', sans-serif; }

    /* Cards */
    .agent-card {
      background: var(--glass-light);
      border: 1px solid var(--border-subtle);
      border-radius: 24px;
      position: relative; overflow: hidden;
      transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

.tool-card {
      background-size: cover; background-position: center;
} 
    .agent-card:active { transform: scale(0.98); } /* Feedback de toque */
    
    @media(hover: hover) {
        .agent-card:hover {
            transform: translateY(-6px) scale(1.01);
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(168, 85, 247, 0.3);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }
    }

    .status-dot {
      width: 8px; height: 8px; background: var(--neon-accent);
      border-radius: 50%; box-shadow: 0 0 8px var(--neon-accent);
      animation: pulse 2s infinite;
    }

    /* Omnibar */
    .omnibar-wrapper {
      position: sticky; top: 20px; z-index: 50;
      display: flex; justify-content: center; width: 100%; padding: 0 20px;
      transition: all 0.3s;
    }
    .omnibar-wrapper.scrolled { top: 10px; }
    .omnibar {
      width: 100%; max-width: 700px;
      background: rgba(15, 15, 20, 0.8); backdrop-filter: blur(20px);
      border: 1px solid var(--border-subtle); border-radius: 99px;
      padding: 8px 8px 8px 24px; display: flex; align-items: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .omnibar input { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 1.1rem; }

    /* Filter Chips */
    .chips-container { -ms-overflow-style: none; scrollbar-width: none; }
    .chips-container::-webkit-scrollbar { display: none; }
    .chip {
      padding: 8px 18px; border-radius: 99px; font-size: 0.85rem; font-weight: 600;
      background: rgba(255,255,255,0.05); border: 1px solid transparent; color: #94a3b8;
      white-space: nowrap; transition: all 0.2s;
    }
    .chip.active { background: rgba(168, 85, 247, 0.15); color: #fff; border-color: rgba(168, 85, 247, 0.3); }

    /* --- GAVETA DESLIZANTE (APP DRAWER) --- */
    .app-frame {
        position: fixed; inset: 0; z-index: 100;
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
        display: flex; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .app-frame.active { opacity: 1; pointer-events: auto; }

    .tool-container {
        background: #0a0a12;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 -20px 50px rgba(0,0,0,0.8);
        display: flex; flex-direction: column;
        position: relative; overflow: hidden;
        transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
    }

    /* Configuração Mobile (Gaveta Inferior) */
    @media (max-width: 768px) {
        .app-frame { align-items: flex-end; } /* Alinha no fundo */
        .tool-container {
            width: 100%;
            height: 97dvh; /* Ocupa 85% da altura da tela */
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            border-bottom: none;
            transform: translateY(100%);
            padding-bottom: 20px; /* Espaço extra para barra de home do iPhone */
        }
        .app-frame.active .tool-container { transform: translateY(0); }
    }

    /* Configuração Desktop (Janela Flutuante) */
    @media (min-width: 769px) {
        .app-frame { align-items: center; }
        .tool-container {
            width: 90%; max-width: 1200px; height: 85vh;
            border-radius: 20px;
            transform: scale(0.95) translateY(20px);
            opacity: 0;
        }
        .app-frame.active .tool-container { transform: scale(1) translateY(0); opacity: 1; }
    }

    /* Cabeçalho da Ferramenta */
    .tool-header {
        height: 60px; flex-shrink: 0;
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 20px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        background: rgba(255,255,255,0.02);
    }

    /* Iframe e Loader */
    .tool-viewport { flex: 1; position: relative; width: 100%; height: 100%; background: #050511; }
    iframe { width: 100%; height: 100%; border: none; display: block; }
    
    .loader-overlay {
        position: absolute; inset: 0; background: #050511; z-index: 10;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    /* Alça de arrastar (Mobile Visual) */
    .drag-handle {
        width: 40px; height: 4px; background: rgba(255,255,255,0.2);
        border-radius: 4px; margin: 8px auto;
    }
    @media(min-width: 769px) { .drag-handle { display: none; } }

    /* Mobile Dock */
    .mobile-dock {
        position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
        background: rgba(20, 20, 30, 0.9); backdrop-filter: blur(15px);
        border: 1px solid rgba(255,255,255,0.1); border-radius: 24px;
        padding: 10px 25px; z-index: 90; display: flex; gap: 25px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    }
    @media(min-width: 769px) { .mobile-dock { display: none; } }

    @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    .skeleton {
        background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%);
        background-size: 200% 100%; animation: shimmer 1.5s infinite;
    }
  </style>

<!-- gtag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3FFD7ZEBN1"></script>
  <script>
    window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}
    gtag('js', new Date()); gtag('config','G-3FFD7ZEBN1',{page_path:location.pathname});
  </script>

</head>
<body>

  <div class="quantum-bg"></div>

  <div class="omnibar-wrapper" id="omnibarWrapper">
    <div class="omnibar">
      <i class="ph-bold ph-command omnibar-icon" style="color:#64748b; font-size:1.2rem; margin-right:10px;"></i>
      <input type="text" id="searchInput" placeholder="Qual agente você precisa?" autocomplete="off">
      <button id="btnFilter" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-300 transition-colors">
         <i class="ph-fill ph-faders"></i>
      </button>
    </div>
  </div>

  <main class="max-w-[1600px] mx-auto px-4 pb-32 pt-6">
    
    <div class="text-center mb-8 fade-in">
        <h1 class="text-4xl md:text-6xl font-bold font-space text-white tracking-tight">
            Capy<span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">Universe</span>
        </h1>
        <p class="text-gray-500 mt-2 text-sm">Sistema Operacional de Agentes</p>
    </div>

    <div class="flex justify-center mb-8">
        <div class="chips-container flex gap-2 overflow-x-auto pb-2 px-4 max-w-full" id="categoryList">
            <button class="chip active" onclick="filterByCategory('', this)">Todos</button>
        </div>
    </div>

    <div id="toolsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
        </div>

    <div id="noResults" class="hidden flex-col items-center justify-center py-20 text-center">
        <i class="ph-duotone ph-ghost text-4xl text-gray-600 mb-2"></i>
        <p class="text-gray-500">Nenhum agente encontrado.</p>
    </div>
  </main>

  <nav class="mobile-dock">
    <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="text-white"><i class="ph-fill ph-house text-xl"></i></button>
    <div class="w-px h-2 bg-white/10"></div>
    <button onclick="openModal('modalApi')" class="text-gray-400 hover:text-white"><i class="ph-bold ph-key text-xl"></i></button>
    <button onclick="openModal('modalInfo')" class="text-gray-400 hover:text-white"><i class="ph-bold ph-info text-xl"></i></button>
  </nav>

  <div id="appFrame" class="app-frame">
    <div class="tool-container">
        <div class="drag-handle md:hidden"></div>
        
        <div class="tool-header">
            <div class="flex items-center gap-3 overflow-hidden">
                <button onclick="closeApp()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-gray-300 md:hidden">
                    <i class="ph-bold ph-caret-down text-xl"></i>
                </button>
                <div class="flex flex-col min-w-0">
                    <span id="frameTitle" class="text-sm font-bold text-white truncate">Carregando...</span>
                    <span id="frameCat" class="text-[10px] text-purple-400 uppercase tracking-wider">App</span>
                </div>
            </div>
            <div class="flex gap-2 items-center">
                <button onclick="refreshApp()" class="p-2 text-gray-400 hover:text-white rounded-lg hover:bg-white/10" title="Recarregar">
                    <i class="ph-bold ph-arrow-clockwise"></i>
                </button>
                <button onclick="openExternal()" class="p-2 text-gray-400 hover:text-white rounded-lg hover:bg-white/10 hidden md:block" title="Nova Aba">
                    <i class="ph-bold ph-arrow-square-out"></i>
                </button>
                <button onclick="closeApp()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 hover:bg-red-500/20 hover:text-red-400 text-gray-300 transition-colors ml-2">
                    <i class="ph-bold ph-x"></i>
                </button>
            </div>
        </div>

        <div class="tool-viewport">
            <div id="frameLoader" class="loader-overlay">
                <i class="ph-duotone ph-spinner-gap text-4xl text-purple-500 animate-spin mb-3"></i>
                <span class="text-xs text-gray-500 font-mono uppercase tracking-widest">Inicializando Neural Link...</span>
            </div>
            <iframe id="appIframe" sandbox="allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-presentation" allow="camera; microphone; clipboard-read; clipboard-write"></iframe>
        </div>
    </div>
  </div>

  <div id="modalApi" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onclick="closeModal('modalApi')">
    <div class="bg-[#13131f] border border-white/10 p-6 rounded-2xl w-full max-w-sm" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2"><i class="ph-fill ph-key text-purple-500"></i> Chave Mestra</h3>
        <input type="password" id="apiKeyInput" class="w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white mb-4 text-sm outline-none focus:border-purple-500 transition-colors" placeholder="Cole sua Gemini API Key...">
        <button onclick="saveApiKey()" class="w-full py-3 bg-purple-600 hover:bg-purple-500 rounded-xl text-white font-bold text-sm transition-colors">Salvar & Conectar</button>
    </div>
  </div>

    <div id="modalInfo" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onclick="closeModal('modalInfo')">
        <div class="bg-[#13131f] border border-white/10 p-6 rounded-2xl w-full max-w-sm relative" onclick="event.stopPropagation()">
            <h2 class="text-xl font-bold text-white mb-2">CapyUniverse OS</h2>
            <p class="text-gray-400 text-sm mb-4">Um ecossistema descentralizado de ferramentas de IA rodando localmente.</p>
            <button onclick="closeModal('modalInfo')" class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm">Fechar</button>
        </div>
    </div>

  <script>
    // --- LÓGICA PRINCIPAL ---
    const els = {
        grid: document.getElementById('toolsGrid'),
        frame: document.getElementById('appFrame'),
        iframe: document.getElementById('appIframe'),
        loader: document.getElementById('frameLoader'),
        search: document.getElementById('searchInput')
    };

    let allTools = [];
    let currentUrl = '';

    // 1. Carregar Ferramentas
    async function bootSystem() {
        renderSkeletons();
        try {
            const res = await fetch('tools.json');
            allTools = await res.json();
            renderCategories();
            renderTools(allTools);
        } catch(e) {
            els.grid.innerHTML = '<p class="text-center text-red-500 col-span-full">Erro no sistema.</p>';
        }
    }

    function renderSkeletons() {
        els.grid.innerHTML = Array(8).fill(0).map(() => `
            <div class="agent-card h-48 skeleton rounded-2xl border border-white/5"></div>
        `).join('');
    }

    function renderCategories() {
        const cats = [...new Set(allTools.map(t => t.category))].sort();
        const container = document.getElementById('categoryList');
        cats.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'chip';
            btn.textContent = c;
            btn.onclick = (e) => filterByCategory(c, e.target);
            container.appendChild(btn);
        });
    }

    function renderTools(list) {
        els.grid.innerHTML = '';
        if(list.length === 0) {
            document.getElementById('noResults').classList.remove('hidden');
            document.getElementById('noResults').classList.add('flex');
            return;
        } else {
            document.getElementById('noResults').classList.add('hidden');
            document.getElementById('noResults').classList.remove('flex');
        }

        list.forEach((tool, i) => {
            const card = document.createElement('div');
            card.className = 'agent-card p-5 h-56 flex flex-col justify-between cursor-pointer group';

card.style.backgroundImage = `url('${tool.imageUrl || 'img/capy.png'}')`;

            card.style.animation = `fadeIn 0.5s ease-out ${i*0.05}s backwards`;
            card.onclick = () => openApp(tool);

            // Ícone
            let icon = tool.iconUrl ? `<img src="${tool.iconUrl}" class="w-full h-full object-contain grayscale group-hover:grayscale-0 transition-all">` 
                     : (tool.icon || '<i class="ph-fill ph-cube"></i>');

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-2xl text-gray-400 group-hover:text-purple-400 group-hover:scale-110 transition-all p-2">
                        ${icon}
                    </div>
                    <span class="status-dot bg-green-500"></span>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-1 group-hover:text-purple-400 transition-colors">${tool.title}</h3>
                    <p class="text-xs text-gray-400 line-clamp-2 leading-relaxed">${tool.description}</p>
                </div>
                <div class="pt-3 border-t border-white/5 flex justify-between items-center">
                    <span class="text-[10px] uppercase font-bold text-gray-600 tracking-wider group-hover:text-gray-400">${tool.category}</span>
                    <i class="ph-bold ph-arrow-right text-gray-600 group-hover:text-white transition-colors"></i>
                </div>
            `;
            els.grid.appendChild(card);
        });
    }

    // --- LÓGICA DA GAVETA E INJEÇÃO DE CSS ---
    function openApp(tool) {
        // Preencher Header
        document.getElementById('frameTitle').textContent = tool.title;
        document.getElementById('frameCat').textContent = tool.category;
        currentUrl = tool.pageUrl;

        // Mostrar Gaveta
        els.frame.classList.add('active');
        els.loader.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Travar fundo

        // Carregar Iframe
        els.iframe.src = tool.pageUrl;

        // --- O PULO DO GATO: INJEÇÃO DE CSS ---
        els.iframe.onload = () => {
            els.loader.style.display = 'none';
            try {
                const doc = els.iframe.contentDocument;
                
                // Criar estilo para esconder headers e sidebars originais
                const style = doc.createElement('style');
                style.textContent = `
                    /* Esconde elementos de navegação da ferramenta */
                    header, .topbar, .cu-header, .global-header, nav.sidebar, #sidebar, .mobile-menu-btn, .mobile-menu {
                        display: none !important;
                    }
                    /* Ajusta o corpo para não ter padding desnecessário */
                    body {
                        padding-top: 0 !important;
                        margin: 0 !important;
                        background-color: transparent !important; /* Deixa ver o fundo do OS */
                        overflow-x: hidden !important;
                    }
                    /* Remove bordas duplicadas */
                    .main-content, main {
                        margin: 0 !important;
                        padding: 20px !important;
                        border: none !important;
                        box-shadow: none !important;
                    }
                    /* Scrollbar bonita dentro do iframe */
                    ::-webkit-scrollbar { width: 6px; }
                    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
                `;
                doc.head.appendChild(style);

                // Injeta o DNA visual (aurora.css) se estiver disponível
                const link = doc.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'aurora.css';
                doc.head.appendChild(link);

            } catch (e) {
                console.warn("Não foi possível injetar estilos (CORS?)");
            }
        };
    }

    window.closeApp = () => {
        els.frame.classList.remove('active');
        document.body.style.overflow = '';
        setTimeout(() => els.iframe.src = 'about:blank', 300); // Limpar
    };

    window.refreshApp = () => {
        els.loader.style.display = 'flex';
        els.iframe.contentWindow.location.reload();
    };

    window.openExternal = () => window.open(currentUrl, '_blank');

    // --- FILTROS E BUSCA ---
    function filterByCategory(cat, btn) {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        
        const term = els.search.value.toLowerCase();
        const filtered = allTools.filter(t => {
            const matchCat = cat ? t.category === cat : true;
            const matchSearch = t.title.toLowerCase().includes(term) || t.description.toLowerCase().includes(term);
            return matchCat && matchSearch;
        });
        renderTools(filtered);
    }

    els.search.addEventListener('input', (e) => {
        // Re-aplica filtro mantendo categoria ativa
        const activeCatBtn = document.querySelector('.chip.active');
        const cat = activeCatBtn && activeCatBtn.textContent !== 'Todos' ? activeCatBtn.textContent : '';
        
        const term = e.target.value.toLowerCase();
        const filtered = allTools.filter(t => {
            const matchCat = cat ? t.category === cat : true;
            const matchSearch = t.title.toLowerCase().includes(term) || t.description.toLowerCase().includes(term);
            return matchCat && matchSearch;
        });
        renderTools(filtered);
    });

    // --- MODAIS ---
    window.openModal = (id) => {
        document.getElementById(id).classList.remove('hidden');
        document.getElementById(id).classList.add('flex');
        if(id === 'modalApi') document.getElementById('apiKeyInput').value = localStorage.getItem('capyUniverseApiKey_gemini') || '';
    }
    window.closeModal = (id) => {
        document.getElementById(id).classList.add('hidden');
        document.getElementById(id).classList.remove('flex');
    }
    window.saveApiKey = () => {
        const k = document.getElementById('apiKeyInput').value;
        if(k) { localStorage.setItem('capyUniverseApiKey_gemini', k); closeModal('modalApi'); alert('Salvo!'); }
    }

    // Animação FadeIn Global
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`;
    document.head.appendChild(styleSheet);

    bootSystem();
  </script>
</body>
</html>

