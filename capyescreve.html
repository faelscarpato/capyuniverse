<!DOCTYPE html>
<html lang="pt-br" data-theme="capyuniverse">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CapyEscreve — Escrita Assistida</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://raw.githubusercontent.com/faelscarpato/capyuniverse/main/2.png" type="image/png" />
  <link rel="stylesheet" href="cu-style.css" />
  <script src="cu-navigation.js" defer></script>
</head>
<body class="min-h-screen flex flex-col">
  <header class="cu-header">
    <div class="cu-brand">
        <a href="index.html" class="flex items-center gap-2 group">
            <div class="cu-logo flex-shrink-0"><img src="icons/icon-512.png"></div>
            <span class="cu-appname text-lg sm:text-xl">CapyUniverse</span>
        </a>
        <span class="ml-3 text-xs text-zinc-400 hidden sm:inline">/ CapyEscreve</span>
    </div>
    <div class="flex items-center gap-2">
        <button id="openManageApiKeyModalButtonHeader" class="cu-btn primary">Chaves API</button>
    </div>
  </header>

  <div class="flex flex-1">
    <aside id="sidebar" class="hidden lg:block cu-panel w-64 space-y-1 p-3 fixed inset-y-0 left-0 z-30 overflow-y-auto pt-20 scrollbar-thin">
      <p class="text-xs text-center text-cu-text-dim p-2">Carregando menu...</p>
    </aside>

    <main class="flex-1 p-4 sm:p-6 lg:p-8 lg:ml-64 w-full">
      <section class="cu-panel p-4 sm:p-6 flex flex-col space-y-6">
        <div class="text-center">
          <h1 class="text-2xl sm:text-3xl font-bold" style="color: var(--cu-sky);">CapyEscreve ✍️</h1>
          <p class="text-cu-text-dim mt-1">Crie textos com auxílio de IA: dite, gere seções e revise.</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-[400px,1fr] gap-6">
          <aside class="cu-panel bg-transparent p-4 space-y-4">
            <div>
              <label class="block text-sm text-cu-text-dim mb-1" for="writeInput">Esboço</label>
              <textarea id="writeInput" rows="7" class="cu-textarea" placeholder="Digite ou dite suas ideias..."></textarea>
            </div>
            <div class="flex items-center gap-3"><button id="btnWriteRecord" class="cu-btn flex-1"><i class="fas fa-microphone"></i> Ditar</button><button id="btnWriteClear" class="cu-btn"><i class="fas fa-eraser"></i></button></div>
            <div>
              <label class="block text-sm text-cu-text-dim mb-1" for="writeCommand">Comando IA</label>
              <input id="writeCommand" class="cu-input" placeholder="Ex: 3 títulos sobre capivaras" />
            </div>
            <div class="flex flex-wrap gap-2">
              <button id="btnWriteTitles" class="cu-btn text-xs">Títulos</button>
              <button id="btnWriteIntro" class="cu-btn text-xs">Introdução</button>
              <button id="btnWriteSection" class="cu-btn text-xs">Seção</button>
              <button id="btnWriteConclusion" class="cu-btn text-xs">Conclusão</button>
              <button id="btnWriteReview" class="cu-btn text-xs">Revisão</button>
            </div>
            <button id="btnWriteCustom" class="cu-btn primary w-full"><i class="fas fa-magic"></i> Executar</button>
          </aside>
          <section class="cu-panel bg-transparent p-4 flex flex-col">
            <label class="block text-sm text-cu-text-dim mb-1" for="writeResult">Resultado</label>
            <textarea id="writeResult" rows="12" class="cu-textarea flex-1" readonly></textarea>
            <div class="flex items-center gap-3 mt-4">
              <button id="btnWriteOuvir" class="cu-btn" disabled><i class="fas fa-volume-high"></i></button>
              <button id="btnWriteCopy" class="cu-btn" disabled><i class="fas fa-copy"></i></button>
              <button id="btnWriteExport" class="cu-btn" disabled><i class="fas fa-download"></i></button>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <script>
    let apiKey = localStorage.getItem('capyUniverseApiKey_gemini') || '';
    let recognition;
    let recording = false;

    const dom = { /* DOM elements */ }; // Simplified

    function updateWriteButtons() { /* ... */ }
    function startWriteRecord() { /* ... */ }
    function stopWriteRecord() { /* ... */ }

    async function handleGenerateWrite(type) {
        if (!apiKey) return alert('Configure a chave API do Gemini.');
        const mainText = document.getElementById('writeInput').value.trim();
        const cmdText = document.getElementById('writeCommand').value.trim();
        let subject = cmdText || mainText;
        if (!subject && type !== 'review') return alert('Insira texto ou comando.');

        let prompt;
        if (type === 'titles') prompt = `Gere 3 títulos sobre: ${subject}`;
        else if (type === 'intro') prompt = `Escreva uma introdução para: ${subject}`;
        else if (type === 'review') prompt = `Revise o texto: ${mainText}`;
        else prompt = subject;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            if (!response.ok) throw new Error(`Erro na API: ${response.status}`);
            const result = await response.json();
            document.getElementById('writeResult').value = result.candidates?.[0]?.content?.parts?.[0]?.text.trim() || '';
        } catch (error) { alert(`Erro: ${error.message}`); }
        finally { updateWriteButtons(); }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedKey = localStorage.getItem('capyUniverseApiKey_gemini');
        if (savedKey) apiKey = savedKey;
        // Add all event listeners here
    });
  </script>
</body>
</html>

