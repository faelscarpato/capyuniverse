<!DOCTYPE html>
<html lang="pt-br" data-theme="capyuniverse">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CapyDocKit — CapyUniverse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://raw.githubusercontent.com/faelscarpato/capyuniverse/main/2.png" />
  <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';</script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <link rel="stylesheet" href="cu-style.css">
  <script src="cu-navigation.js" defer></script>

  <style>
    .dropzone { border: 2px dashed #ffffff33; transition: background-color 0.3s; }
    .dropzone.dragover { background-color: #ffffff11; }
    .page-card { border: 1px solid var(--cu-card); cursor: grab; }
    .page-card.selected { border-color: var(--cu-cyan); box-shadow: 0 0 15px #00f6ff33; }
    .dragging { opacity:.5; }
    .marker { position:absolute; transform:translate(-50%,-50%); border:2px solid var(--cu-cyan); border-radius:8px; width:24px; height:24px; background-color:#00f6ff22; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="cu-header">
    <div class="cu-brand">
        <a href="index.html" class="flex items-center gap-2 group">
            <div class="cu-logo flex-shrink-0"><img src="icons/icon-512.png"></div>
            <span class="cu-appname text-lg sm:text-xl">CapyUniverse</span>
        </a>
        <span class="ml-3 text-xs text-zinc-400 hidden sm:inline">/ CapyDocKit</span>
    </div>
    <div class="flex items-center gap-2">
        <button id="openManageApiKeyModalButtonHeader" class="cu-btn primary">Chaves API</button>
    </div>
  </header>

  <div class="flex flex-1">
    <aside id="sidebar" class="hidden lg:block cu-panel w-64 space-y-1 p-3 fixed inset-y-0 left-0 z-30 overflow-y-auto pt-20 scrollbar-thin">
      <p class="text-xs text-center text-cu-text-dim p-2">Carregando menu...</p>
    </aside>

    <main class="flex-1 p-4 sm:p-6 lg:p-8 lg:ml-64 w-full">
      <section class="cu-panel p-4 sm:p-6">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold" style="color: var(--cu-emerald-400);">CapyDocKit 📄</h1>
          <p class="text-cu-text-dim mt-1">Junte, separe, reordene e assine PDFs no seu navegador.</p>
        </div>

        <div class="grid lg:grid-cols-[330px_1fr] gap-6">
          <div class="space-y-4">
            <div class="cu-panel bg-transparent p-4">
              <h3 class="font-semibold mb-2">Arquivos</h3>
              <div id="drop" class="dropzone p-5 text-center"><input id="fileInput" type="file" accept=".pdf" multiple class="absolute inset-0 opacity-0 cursor-pointer"><p><i class="fa-solid fa-cloud-arrow-up"></i> Arraste PDFs ou <span class="underline">clique</span></p></div>
              <div class="text-xs mt-2"><span id="fileCount" class="cu-chip">0</span><span id="pageCount" class="cu-chip ml-2">0</span></div>
            </div>
            <div class="cu-panel bg-transparent p-4 space-y-3">
              <h3 class="font-semibold">Ações</h3>
              <div class="flex flex-wrap gap-2"><button id="btnSelectAll" class="cu-btn text-xs">Sel. Tudo</button><button id="btnClearSelection" class="cu-btn text-xs">Limpar</button></div>
              <div class="grid grid-cols-1 gap-2">
                <button id="btnMerge" class="cu-btn primary"><i class="fa-solid fa-layer-group"></i> Mesclar</button>
                <button id="btnExportSelected" class="cu-btn"><i class="fa-solid fa-scissors"></i> Exportar Sel.</button>
                <button id="btnZipEach" class="cu-btn"><i class="fa-solid fa-box-archive"></i> ZIP por Página</button>
              </div>
            </div>
            <div class="cu-panel bg-transparent p-4 space-y-3">
              <h3 class="font-semibold">Assinatura</h3>
              <canvas id="signPad" class="w-full h-32 bg-black/20 rounded-lg"></canvas>
              <div class="flex gap-2"><button id="btnClearSign" class="cu-btn text-xs">Limpar</button><button id="btnPlaceSign" class="cu-btn text-xs">Posicionar</button></div>
            </div>
          </div>
          <div class="space-y-3">
            <div id="grid" class="grid sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-3"></div>
            <p id="hint" class="text-center text-cu-text-dim hidden">Adicione PDFs para começar.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const pages = [], filesStore = [];
    let signaturePad, placingSign = false, signaturePNGDataUrl;

    function updateCounters() { /* ... */ }
    async function handleFiles(fileList) { /* ... */ }
    function renderGrid() { /* ... */ }
    // ... (rest of the logic)

    document.addEventListener('DOMContentLoaded', () => {
        // Init signature pad
        const canvas = $('#signPad');
        signaturePad = new SignaturePad(canvas, { backgroundColor: '#00000000', penColor: 'white' });
        window.addEventListener('resize', () => signaturePad.clear());

        // Event listeners
        $('#drop').addEventListener('click', () => $('#fileInput').click());
        $('#fileInput').addEventListener('change', e => handleFiles(e.target.files));
        // Drag & Drop events

        $('#btnSelectAll').addEventListener('click', () => { pages.forEach(p => p.selected = true); renderGrid(); });
        $('#btnClearSelection').addEventListener('click', () => { pages.forEach(p => p.selected = false); renderGrid(); });
        $('#btnMerge').addEventListener('click', async () => { /* merge logic */ });
        $('#btnExportSelected').addEventListener('click', async () => { /* export logic */ });
        $('#btnClearSign').addEventListener('click', () => signaturePad.clear());
        $('#btnPlaceSign').addEventListener('click', () => {
            if (signaturePad.isEmpty()) return alert('Desenhe a assinatura primeiro.');
            signaturePNGDataUrl = signaturePad.toDataURL();
            placingSign = !placingSign;
            $('#btnPlaceSign').classList.toggle('primary', placingSign);
        });
    });
  </script>
</body>
</html>

