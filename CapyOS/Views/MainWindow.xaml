<Window x:Class="CapyOS.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:CapyOS.Controls"
        xmlns:views="clr-namespace:CapyOS.Views"
        Title="{Binding Title}" Width="920" Height="600" WindowStartupLocation="CenterScreen">
    <Window.InputBindings>
        <KeyBinding Modifiers="Control" Key="Tab" Command="{Binding CycleWindowsCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CloseActiveCommand}"/>
        <KeyBinding Modifiers="Control" Key="Right" Command="{Binding NextWorkspaceCommand}"/>
        <KeyBinding Modifiers="Control" Key="Left" Command="{Binding PrevWorkspaceCommand}"/>
        <KeyBinding Key="F10" Command="{Binding ToggleMissionControlCommand}"/>
        <KeyBinding Modifiers="Ctrl+Shift" Key="C" Command="{Binding FocusCapyMateCommand}"/>
    </Window.InputBindings>
        <Grid Background="{DynamicResource App.BackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
        <DockPanel Margin="16" Grid.Row="0">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <Button x:Name="StartMenuButton" Content="Menu" Command="{Binding ToggleStartMenuCommand}"/>
                <Popup PlacementTarget="{Binding ElementName=StartMenuButton}" Placement="Bottom" StaysOpen="False" IsOpen="{Binding IsStartMenuOpen, Mode=TwoWay}">
                    <Border Background="{DynamicResource App.SurfaceBrush}" CornerRadius="8" Padding="12" BorderBrush="#22000000" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="Iniciar" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource App.ForegroundBrush}"/>
                            <StackPanel Margin="0,8,0,0">
                                <Button Content="Abrir CapyIDE" Command="{Binding OpenAppByIdCommand}" CommandParameter="capy.ide"/>
                                <Button Content="Abrir CapyDoc" Command="{Binding OpenAppByIdCommand}" CommandParameter="capy.doc"/>
                                <Button Content="Abrir Configurações" Command="{Binding ToggleSettingsScreenCommand}"/>
                                <Button Content="Abrir CapyStore" Command="{Binding OpenAppByIdCommand}" CommandParameter="capy.store"/>
                                <Button Content="Abrir CapyLove" Command="{Binding OpenAppByIdCommand}" CommandParameter="capy.love"/>
                                <Button Content="Abrir CapyMate" Command="{Binding FocusCapyMateCommand}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Popup>
                <TextBlock Text="{Binding Title}" FontSize="20" FontWeight="SemiBold" Foreground="{DynamicResource App.ForegroundBrush}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                <ItemsControl ItemsSource="{Binding Workspaces}" Margin="16,0,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border CornerRadius="6" Padding="8,4" Margin="4,0" Background="{DynamicResource App.SurfaceBrush}">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Opacity" Value="0.9"/>
                                    </Style>
                                </Border.Style>
                                <Button Content="{Binding Name}" Command="{Binding DataContext.SwitchWorkspaceCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding Index}"/>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Button Content="+" Margin="8,0,0,0" Command="{Binding CreateWorkspaceCommand}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                <Button Content="CapyStore" Command="{Binding OpenAppByIdCommand}" CommandParameter="capy.store"/>
                <Button Content="Configurações" Command="{Binding ToggleSettingsScreenCommand}"/>
                <TextBlock Text="{Binding Theme}" Foreground="{DynamicResource App.ForegroundBrush}" Margin="12,0" VerticalAlignment="Center"/>
                <Button Content="Alternar tema" Command="{Binding ToggleThemeCommand}"/>
            </StackPanel>
        </DockPanel>
        <Grid Grid.Row="1">
            <Grid>
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsHomeVisible}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <ItemsControl ItemsSource="{Binding Windows}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Canvas.Left" Value="{Binding X}"/>
                            <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                            <Setter Property="Panel.ZIndex" Value="{Binding ZIndex}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMinimized}" Value="True">
                                    <Setter Property="Opacity" Value="0"/>
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsMinimized}" Value="False">
                                    <Setter Property="Opacity" Value="1"/>
                                    <Setter Property="IsHitTestVisible" Value="True"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <controls:AppWindowControl/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
            <views:HomeView>
                <views:HomeView.Style>
                    <Style TargetType="views:HomeView">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsHomeVisible}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </views:HomeView.Style>
            </views:HomeView>
        </Grid>
        <Border Grid.Row="2" Background="{DynamicResource App.SurfaceBrush}" Padding="8" BorderThickness="1" BorderBrush="#22000000">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding DockApps}" Margin="0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8" Margin="4" CornerRadius="6" Background="{DynamicResource App.SurfaceBrush}">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsOpenInternal}" Value="True">
                                                <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding IconPath}" FontSize="14" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Name}" Margin="6,0,8,0" VerticalAlignment="Center" Foreground="{DynamicResource App.ForegroundBrush}"/>
                                    <Button Content="Abrir" Command="{Binding DataContext.OpenAppByIdCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding Id}"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
        <Grid x:Name="MissionOverlay" Grid.RowSpan="3" Background="#99000000">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Opacity" Value="0"/>
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Setter Property="IsHitTestVisible" Value="False"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsMissionControlVisible}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Setter Property="IsHitTestVisible" Value="True"/>
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <Border Margin="24" Background="{DynamicResource App.SurfaceBrush}" CornerRadius="12">
                <ScrollViewer>
                    <ItemsControl ItemsSource="{Binding Windows}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Width="240" Height="160" Margin="12" CornerRadius="10" Background="{DynamicResource App.BackgroundBrush}">
                                    <Border.RenderTransform>
                                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                                    </Border.RenderTransform>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <EventTrigger RoutedEvent="MouseEnter">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" To="1.05" Duration="0:0:0.12"/>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" To="1.05" Duration="0:0:0.12"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                                <EventTrigger RoutedEvent="MouseLeave">
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" To="1" Duration="0:0:0.12"/>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" To="1" Duration="0:0:0.12"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <DockPanel Margin="8" Grid.Row="0">
                                            <TextBlock Text="{Binding Icon}" FontSize="14"/>
                                            <TextBlock Text="{Binding Title}" Margin="6,0,0,0" Foreground="{DynamicResource App.ForegroundBrush}"/>
                                        </DockPanel>
                                        <Button Grid.Row="1" Background="#22000000" BorderThickness="0" Command="{Binding DataContext.ActivateFromMissionControlCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
        </Grid>
        <Grid x:Name="SettingsOverlay" Grid.RowSpan="3" Background="#66000000">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Opacity" Value="0"/>
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Setter Property="IsHitTestVisible" Value="False"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSettingsScreenVisible}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Setter Property="IsHitTestVisible" Value="True"/>
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            <Grid>
                <views:SettingsScreen HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </Grid>
    </Grid>
</Window>
